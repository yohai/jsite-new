<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complex Function Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .latex-container {
            border: 1px solid #ddd;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        svg {
            width: 100%;
            height: auto;
        }
        #equation {
            font-size: 16px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="d-flex flex-column align-items-center justify-content-center">
    <div class="container">
        <div class="row justify-content-center" style="padding-top: 40px;">
            <div class="col-md-8" >
                <div class="latex-container text-center">
                    <p>
                        <p class="text-start">
                            This shows the function f(z) = z<sup>α</sup>, for various alphas and choices of the branch cut.
                            Note how the results is independent of the choice of branch cut when α is an integer. In this case, 
                            the complex plane maps onto itself exactly α times.
                        </p>
                    </p>
                    <div id="equation">f(z) = z<sup>α</sup></div>
                    <div class="slider-container mb-3">
                        <label for="alpha" class="form-label">α = <span id="alphaValue">1.0</span></label>
                        <input type="range" class="form-range" id="alpha" min="0" max="3" step="0.05" value="1">
                    </div>
                    <div class="slider-container mb-3">
                        <label for="branchAngle" class="form-label">
                            Branch Cut Angle (°) = <span id="branchAngleValue">180</span>
                        </label>
                        <input type="range" class="form-range" id="branchAngle" min="-180" max="180" step="5" value="180">
                    </div>
                    <div class="button-container">
                        <button id="restoreDefaults" class="btn btn-primary">Restore Defaults</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <!-- Responsive SVG Wrapper -->
                <div class="ratio ratio-1x1">
                    <svg id="chart" class="border" viewBox="0 0 600 600" preserveAspectRatio="xMidYMid meet"></svg>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Your D3.js code remains unchanged
        const width = 600;
        const height = 600;
        const W = 3;
        const H = 3;
        const coarse = 0.5;
        const fine = 0.03;

        const defaultAlpha = 1.0;
        const defaultBranchAngle = 180;

        const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
        const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);

        const svg = d3.select("#chart");

        function genPoints(W, H, coarse, fine) {
            const hlines = [];
            const vlines = [];
            for (let x = -W; x <= W; x += fine) {
                for (let y = -H; y <= H; y += coarse) hlines.push([x, y]);
            }
            for (let x = -W; x <= W; x += coarse) {
                for (let y = -H; y <= H; y += fine) vlines.push([x, y]);
            }
            return { hlines, vlines };
        }

        function f(points, alpha, branchAngle) {
            const branchAngleRad = (branchAngle * Math.PI) / 180;

            // Precompute r and theta for all points
            const r = points.map(([x, y]) => Math.sqrt(x * x + y * y));
            const theta = points.map(([x, y]) => Math.atan2(y, x));

            // Adjust theta for the branch cut
            const adjustedTheta = theta.map((t) => {
                if (branchAngleRad < 0 && t < branchAngleRad) {
                    return t + 2 * Math.PI;
                } else if (branchAngleRad >= 0 && t > branchAngleRad) {
                    return t - 2 * Math.PI;
                }
                return t;
            });

            // Compute rAlpha and thetaAlpha
            const rAlpha = r.map((r) => Math.pow(r, alpha));
            const thetaAlpha = adjustedTheta.map((t) => t * alpha);

            // Compute the transformed points
            return points.map((_, i) => [
                rAlpha[i] * Math.cos(thetaAlpha[i]),
                rAlpha[i] * Math.sin(thetaAlpha[i]),
            ]);
        }

        function applyFunc(points, alpha, branchAngle) {
            return f(points, alpha, branchAngle);
        }


        function drawBranchCut(branchAngle) {
            svg.selectAll(".branch-cut").remove();
            const branchAngleRad = (branchAngle * Math.PI) / 180;
            const x = Math.cos(branchAngleRad) * 10;
            const y = Math.sin(branchAngleRad) * 10;
            svg.append("line")
                .attr("class", "branch-cut")
                .attr("x1", xScale(0))
                .attr("y1", yScale(0))
                .attr("x2", xScale(x))
                .attr("y2", yScale(y))
                .attr("stroke", "black")
                .attr("stroke-width", 8);
        }

        function drawPoints(points, color) {
            svg.selectAll(`.point-${color}`)
                .data(points)
                .join("circle")
                .attr("class", `point-${color}`)
                .attr("cx", d => xScale(d[0]))
                .attr("cy", d => yScale(d[1]))
                .attr("r", 1.5)
                .attr("fill", color);
        }

        const { hlines, vlines } = genPoints(W, H, coarse, fine);
        function update(alpha, branchAngle) {
            const hPoints = applyFunc(hlines, alpha, branchAngle);
            const vPoints = applyFunc(vlines, alpha, branchAngle);
            drawPoints(hPoints, "blue");
            drawPoints(vPoints, "red");
            drawBranchCut(branchAngle);
        }

        update(defaultAlpha, defaultBranchAngle);

        const alphaInput = d3.select("#alpha");
        const alphaValue = d3.select("#alphaValue");
        const branchAngleInput = d3.select("#branchAngle");
        const branchAngleValue = d3.select("#branchAngleValue");
        const restoreButton = d3.select("#restoreDefaults");

        function handleInput() {
            const alpha = +alphaInput.node().value;
            const branchAngle = +branchAngleInput.node().value;
            alphaValue.text(alpha.toFixed(1));
            branchAngleValue.text(branchAngle);
            update(alpha, branchAngle);
        }

        function restoreDefaults() {
            alphaInput.node().value = defaultAlpha;
            branchAngleInput.node().value = defaultBranchAngle;
            alphaValue.text(defaultAlpha.toFixed(1));
            branchAngleValue.text(defaultBranchAngle);
            update(defaultAlpha, defaultBranchAngle);
        }

        alphaInput.on("input", handleInput);
        branchAngleInput.on("input", handleInput);
        restoreButton.on("click", restoreDefaults);
    </script> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
